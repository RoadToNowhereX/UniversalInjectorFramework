name: Build UniversalInjectorFramework

on:
  push:
    branches: [ "master", "main" ]
  pull_request:
    branches: [ "master", "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    strategy:
      matrix:
        configuration: [Release]
        # 修改点：将 x86 改为 Win32
        platform: [x64, Win32]

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Add MSBuild to PATH
      uses: microsoft/setup-msbuild@v1.3

    - name: Restore NuGet packages
      working-directory: src
      run: nuget restore UniversalInjectorFramework.sln

    - name: Build Solution
      working-directory: src
      # 使用 matrix.platform 变量，现在它会是 'Win32' 或 'x64'，这符合 VS 的标准
      run: msbuild UniversalInjectorFramework.sln /p:Configuration=${{ matrix.configuration }} /p:Platform=${{ matrix.platform }}

    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: UniversalInjectorFramework-${{ matrix.platform }}-${{ matrix.configuration }}
        # 注意：由于 Win32 和 x64 的输出目录结构通常不同，使用 ** 通配符可以同时匹配到：
        # Win32通常在: src/Release/
        # x64通常在:   src/x64/Release/
        path: |
          src/**/Release/*.exe
          src/**/Release/*.dll
          src/**/Release/*.lib
