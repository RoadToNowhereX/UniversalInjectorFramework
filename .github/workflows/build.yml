name: Build DLL Only

on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: windows-latest
    
    strategy:
      matrix:
        configuration: [Release]
        # 直接编译 vcxproj 时，必须使用 'Win32' (代表x86) 和 'x64'
        platform: [Win32, x64]

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Add MSBuild to PATH
      uses: microsoft/setup-msbuild@v1.3

    - name: Restore NuGet packages
      working-directory: src
      run: nuget restore UniversalInjectorFramework.sln

    - name: Build C++ Project Directly
      working-directory: src
      # 修改点：直接指向 .vcxproj 文件，而不是 .sln
      # 这样就可以强制使用 Win32 和 x64 平台参数
      run: msbuild UniversalInjectorFramework/UniversalInjectorFramework.vcxproj /p:Configuration=${{ matrix.configuration }} /p:Platform=${{ matrix.platform }}

    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: UniversalInjectorFramework-${{ matrix.platform }}
        path: |
          src/**/Release/*.dll
          src/**/Release/*.lib
          src/**/x64/Release/*.dll
          src/**/x64/Release/*.lib
